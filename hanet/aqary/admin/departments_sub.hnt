<?
include_once"../nocash.hnt";
include_once"../header.hnt";
$sql="select *, FROM_UNIXTIME(dep_lastmodified,'%d-%m-%Y  %h:%i:%s')  as dep_lastmodified  from departments_name where dep_id='".$_REQUEST[dep_id]."'";
$result=mysql_query($sql,$link);
$dep_data=mysql_fetch_array($result);

if($_REQUEST['formuid']){
	$sql="select count(fld_id) as dd from   department_field  where formuid = '".$_REQUEST['formuid']."' ";
	$row=mysql_fetch_array(mysql_query($sql,$link));
	if($row['dd']){
		echo "<div class='col_12 center'><h5 class='uifont18 center' style='color:red'> ��� ��� ����� ����� ����� ����� </h5></div>";
		exit();
	}
}


/*
    [0] => 1
    [dep_id] => 1
    [1] => ����� ���������
    [dep_name] => ����� ���������
    [2] => mhtatalbnzynat
    [dep_en_name] => mhtatalbnzynat
    [3] => images/48x48/email.png
    [dep_image] => images/48x48/email.png
    [4] => images/24x24/email.png
    [dep_image_small] => images/24x24/email.png
    [5] => 1
    [dep_isactive] => 1
    [6] => dgn_mhtatalbnzynat
    [dep_table_name] => dgn_mhtatalbnzynat
    [7] => 1237240165
    [dep_lastmodified] => 1237240165
    [8] =>
    [dep_isdeleted] =>
*/


echo <<<end

<img src='\aqary\admin\images\goback.png'
style="cursor:hand;position: absolute;  z-index: 1;left:10px; top: 50px"
onclick="window.location.href='/aqary/admin/departments.hnt';"
 border=0 alt="������ ��� ����� �������">


<div dir='rtl' class='uifont16 greentext'>
<img src="/aqary/admin/$dep_data[dep_image]" border=0>
��� : $dep_data[dep_name]  -
��� ����� :$dep_data[dep_lastmodified]

</div>
end;


if($_REQUEST[fld_name])
{

	$_REQUEST[fld_values]=str_replace(";","\r\n",$_REQUEST[fld_values]);
	$_REQUEST[fld_values]=str_replace(",","\r\n",$_REQUEST[fld_values]);
	$_REQUEST[fld_values]=str_replace("-","\r\n",$_REQUEST[fld_values]);

	$_REQUEST[fld_en_name] = $_REQUEST[fld_en_name]."_".time();


	$sql="insert into department_field set
		fld_name='".$_REQUEST[fld_name]."',
		fld_en_name='".$_REQUEST[fld_en_name]."',
		fld_table_name='".$_REQUEST[fld_table_name]."',
		fld_isactive='".$_REQUEST[fld_isactive]."',
		fld_required='".$_REQUEST[fld_required]."',
		fld_values='".$_REQUEST[fld_values]."',
		dep_id='".$_REQUEST[dep_id]."',
		fld_type='".$_REQUEST[fld_type]."' ,
		formuid = '".$_REQUEST['formuid']."'
	";
		if($_REQUEST[update_fld_id]){
			$sql="update department_field set
				fld_name='".$_REQUEST[fld_name]."',
				fld_isactive='".$_REQUEST[fld_isactive]."',
				fld_required='".$_REQUEST[fld_required]."',
				fld_values='".$_REQUEST[fld_values]."',
				fld_type='".$_REQUEST[fld_type]."' ,
				formuid = '".$_REQUEST['formuid']."'
				where fld_id='".$_REQUEST[update_fld_id]."'
			";
		}


	mysql_query($sql);

	$sql="alter table $_REQUEST[fld_table_name] ADD " . $_REQUEST[fld_en_name]." VARCHAR( 600 ) NOT NULL ";
	if($_REQUEST[fld_type]==2){$sql="alter table $_REQUEST[fld_table_name] ADD  " . $_REQUEST[fld_en_name]."  TEXT NOT NULL  ";}
	mysql_query($sql);


}

if($_REQUEST[edit_field_id]){
$sql="select * from department_field  where fld_id='".$_REQUEST[edit_field_id]."'";
$edit_field=mysql_fetch_array(mysql_query($sql,$link));
}
?>

<script>
function displaysample(id)
{
for(i=1;i<8;i++)
document.getElementById('sample'+i).style.display="none";

if(id>0){document.getElementById('sample'+id).style.display="block";}

}
</script>

<style>
.labeltext{
	clear: both !important;
    display: inherit;
    padding-top: 15px;
    padding-bottom: 3px;

}
</style>





<div class="col_12 uifont16" >
<form dir=rtl method=post action=departments_sub.hnt >
<input type='hidden' name=formuid id="formuid"
value="<?=str_replace('.','',microtime(true).rand(11111,99999).rand(11111,99999).rand(111,999).rand(111,999));?>"  >
<!--
fld_id
   fld_name  varchar(245)     Yes
   fld_en_name  varchar(245)     Yes
   fld_table_name  varchar(245)     Yes
   fld_isactive  varchar(245)     Yes
   fld_required
   fld_values  text     Yes
   dep_id  int(11)     Yes
   fld_type


-->
<input type="hidden" name="dep_id" id="dep_id" value="<?=$dep_data[dep_id];?>" >
<input type="hidden" name="update_fld_id"   value="<?=$edit_field[fld_id];?>" >
<?
$x=$edit_field[fld_type];
$sel[$x]=" selected ";
?>
<div class="col_4 uifont16" >

<span class="labeltext">��� �����:</span><select id="fld_type" name="fld_type"  onchange="displaysample(this.value)">
<option <?=$sel[1];?> value=1>���� ��</option>
<option <?=$sel[2];?> value=2>����� ���</option>
<option <?=$sel[3];?> value=3>����� ��������</option>
<option <?=$sel[7];?> value=4>����� ��������</option>
<option <?=$sel[5];?> value=5>����� ������</option>
<option <?=$sel[6];?> value=6>��� �����</option>
<option <?=$sel[7];?> value=7>�� ���� �������</option>
</select><br>
<span class="labeltext">��� �����:</span><input style="width:180px;" type=text name="fld_name" id="fld_name" value="<?=$edit_field[fld_name]?>" onkeyup="ajaxpost('entrando.hnt?mystring='+this.value,'','fld_en_name');" ><br>
<span class="labeltext">��� �������:</span><input style="width:180px;" type=text name="fld_en_name" id="fld_en_name"  value="<?=$edit_field[fld_en_name]?>"  readonly><br>
<span class="labeltext">��� ������:</span><input style="width:180px;" type=text name="fld_table_name" readonly value="<?=$dep_data[dep_table_name];?>"><br>
<span class="labeltext">���� �� ��:</span><select class="smallbutton"  name=fld_isactive>
<?$x=$edit_field[fld_isactive];$sel[$x]=" selected ";?>
<option <?=$sel[1];?> value=1>��� </option><option  <?=$sel[2];?> value=2>��</option></select>
<span class="labeltext">������ �� ��:</span><select class="smallbutton"  name=fld_required>
<?$x=$edit_field[fld_required];$sel[$x]=" selected ";?>
<option <?=$sel[2];?> value=2>��</option><option  <?=$sel[1];?> value=1>��� </option></select>

<br><span class="labeltext">���� ������:</span><textarea name="fld_values" id="fld_values"
title="���� ���� ������ ����� ����� ���� �� ����� - ��  ����� ; �� ����� ,"
style="width:180px;height:200px"><?=$edit_field[fld_values]?></textarea>
<?
if($_REQUEST[edit_field_id]){$btn=" ����� ����� ";}else{$btn=" ����� ����� ";}
?>
<br><span class="labeltext">&nbsp;</span><input type="submit"  value="<?=$btn;?>">
<button onclick="window.location.href='/aqary/admin/departments_sub.hnt?dep_id=<?=$_REQUEST[dep_id];?>';" >��� ���� </button>

</div>





<div  class="col_8 uifont16"   >

<div class="col_12 uifont16 bluetext" >
���� : <br>
<input type=text id="sample1" style="display:none">
<textarea id="sample2" style="display:none;width:180px;height:30px"></textarea>
<select id="sample3" style="display:none" ><option>���� 1</option><option>���� 2</option></select>
<div id="sample4" style="display:none">
<input type=radio name=rdio1> ������ 1
<input type=radio name=rdio1> ������ 2
<input type=radio name=rdio1> ������ 3
<input type=radio name=rdio1> ������ 4
....
</div>

<div id="sample5" style="display:none" ><input type=checkbox > ��� �� ��  ....</div>
<input type=file id="sample6" style="display:none">
<input type=button value="���� �������" id="sample7" style="display:none">


</div>

<span class=labeltext>������:</span>
<?
$sql="select * from department_field  where dep_id ='".$_REQUEST[dep_id]."'";
$result=mysql_query($sql,$link);
while($field_data=mysql_fetch_array($result))
{
$actiontodo="<img src='/aqary/admin/images/edit.png' border=0 style='cursor:hand'
onclick=\"window.location.href='/aqary/admin/departments_sub.hnt?dep_id=$_REQUEST[dep_id]&edit_field_id=".$field_data[0]."';\"
alt='����� ��� ����� ������� ������ ������ ����� '>";

$actiondelete="<img src='/aqary/admin/images/maildelete.gif' border=0 style='cursor:hand'
class='policy_{$sc_id}_deleetes'
onclick=\"
confirm('�� ���� �� ��� ��� ����� ',
'�����',
function(){ajaxmysql('delete from department_field  where fld_id=".$field_data[fld_id]." ');});return false;\"
alt='��� �����  '>";

$actionrepaire="<img src='/aqary/admin/images/refresh.gif' border=0 style='cursor:hand'
onclick=\"window.location.href='/aqary/admin/departments_sub.hnt?edit_id=".$row['�']."';\"
alt='����� ��� ����� ������� ������ ������ ����� '>";


switch ($field_data[fld_type]) {
    case 0:
        echo "��� ����� ��� ����� ������ ������";
        break;
    case 1:
        echo "<span class=labeltext>$field_data[fld_name]:</span><input type=text name='$field_data[fld_en_name]' title='$field_data[fld_values]'> ";
        break;
    case 2:
        echo "<span class=labeltext>$field_data[fld_name]:</span><textarea style='width:75%;height:100px'  name='$field_data[fld_en_name]' title='$field_data[fld_values]'></textarea> ";
        break;
    case 3:
	$field_allvalues= explode("\r\n",$field_data[fld_values]);
	echo "<span class=labeltext>$field_data[fld_name]:</span><select name='$field_data[fld_en_name]'>";
		foreach ($field_allvalues as $value) {
    	echo "<option value='$value'>$value</option>";
	}

        echo "</select>";
        break;
    case 4:
	$field_allvalues= explode("\r\n",$field_data[fld_values]);
	echo"<span class=labeltext>$field_data[fld_name]:</span>";
	foreach ($field_allvalues as $value) {
    	echo "<input type=radio name='$field_data[fld_en_name]' value='$value'>$value &nbsp&nbsp";
	}


        break;
    case 5:
        echo "<span class=labeltext>$field_data[fld_name]:</span><input type=checkbox name='$field_data[fld_en_name]' > $field_data[fld_values]";
        break;
    case 6:
        echo "<span class=labeltext>$field_data[fld_name]:</span><input type=file name='$field_data[fld_en_name]' > ";
        break;
    case 7:
        echo "<span class=labeltext>$field_data[fld_name]:</span><input type=button name='$field_data[fld_en_name]' value='$field_data[fld_values]' > ";
        break;

	}
echo $actiontodo .$actiondelete. $actionrepaire;


}


?>



</div>




</form>

</div>




